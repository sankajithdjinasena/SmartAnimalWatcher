<!DOCTYPE html>
<html>
<head>
    <title>Detection Logs - Security System</title>
    <link rel="stylesheet" href="css/logs.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Detection History Log</h1>
            <p class="subtitle">Comprehensive record of all animal detections and threat assessments</p>

            <div class="header-stats">
                <div class="stat-box">
                    <div class="stat-value">{{ all_logs|length }}</div>
                    <div class="stat-label">Total Detections</div>
                </div>

                <div class="stat-box">
                    <div class="stat-value">
                        {{ all_logs|selectattr('risk', 'equalto', 'High')|list|length }}
                    </div>
                    <div class="stat-label">High Risk</div>
                </div>

                <div class="stat-box">
                    <div class="stat-value">24h</div>
                    <div class="stat-label">Time Period</div>
                </div>

                <div class="stat-box">
                    <div class="stat-value">
                        {{ all_logs|map(attribute='animal')|unique|list|length }}
                    </div>
                    <div class="stat-label">Unique Species</div>
                </div>
            </div>
        </header>


        <div class="controls">
            <button class="back-button">
                <a href="{{ url_for('index') }}" style="color: inherit; text-decoration: none;">
                    Back to Live Dashboard
                </a>
            </button>
            
            <div class="filter-controls">
                <a class="filter-btn {% if risk_filter=='all' %}active{% endif %}"
                href="{{ url_for('view_logs', risk='all') }}">All</a>

                <a class="filter-btn {% if risk_filter=='high' %}active{% endif %}"
                href="{{ url_for('view_logs', risk='high') }}">High Risk</a>

                <a class="filter-btn {% if risk_filter=='today' %}active{% endif %}"
                href="{{ url_for('view_logs', risk='today') }}">Today</a>

                <a class="filter-btn {% if risk_filter=='week' %}active{% endif %}"
                href="{{ url_for('view_logs', risk='week') }}">This Week</a>
            </div>

        </div>

        {% if logs %}
        <div class="logs-container">
            <table>
                <thead>
                    <tr>
                        <th style="width: 30%;">
                            <span style="display: flex; align-items: center; gap: 10px;">
                                <span>ü¶Å</span> Animal Species
                            </span>
                        </th>
                        <th style="width: 25%;">
                            <span style="display: flex; align-items: center; gap: 10px;">
                                <span>‚ö†Ô∏è</span> Threat Level
                            </span>
                        </th>
                        <th style="width: 45%;">
                            <span style="display: flex; align-items: center; gap: 10px;">
                                <span>üïí</span> Detection Timestamp
                            </span>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in logs %}
                    <tr>
                        <td>
                            <span class="animal-icon">
                                {% if 'bear' in log.animal|lower %}üêª
                                {% elif 'wolf' in log.animal|lower %}üê∫
                                {% elif 'cat' in log.animal|lower %}üêà
                                {% elif 'dog' in log.animal|lower %}üêï
                                {% elif 'fox' in log.animal|lower %}ü¶ä
                                {% elif 'deer' in log.animal|lower %}ü¶å
                                {% elif 'monkey' in log.animal|lower %}üêí
                                {% elif 'crocodile' in log.animal|lower %}üêä
                                {% elif 'alligator' in log.animal|lower %}üêä
                                {% elif 'lion' in log.animal|lower %}ü¶Å
                                {% elif 'tiger' in log.animal|lower %}üêØ
                                {% elif 'snake' in log.animal|lower %}üêç
                                {% elif 'boar' in log.animal|lower %}üêó
                                {% elif 'elephant' in log.animal|lower %}üêò
                                {% elif 'rhino' in log.animal|lower %}ü¶è
                                {% elif 'leopard' in log.animal|lower %}üêÜ
                                {% elif 'hyena' in log.animal|lower %}üêï
                                {% else %}{% endif %}
                            </span>
                            {{ log.animal }}
                        </td>
                        <td>
                            {% set risk_class = 'risk-' + log.risk|lower %}
                            {% if log.risk|lower == 'critical' %}
                            <span class="risk-badge risk-critical">üö® {{ log.risk }}</span>
                            {% elif log.risk|lower == 'high' %}
                            <span class="risk-badge risk-high">‚ö†Ô∏è {{ log.risk }}</span>
                            {% elif log.risk|lower == 'medium' %}
                            <span class="risk-badge risk-medium">üî∏ {{ log.risk }}</span>
                            {% else %}
                            <span class="risk-badge risk-low">‚úÖ {{ log.risk }}</span>
                            {% endif %}
                        </td>
                        <td>
                            <span class="timestamp">{{ log.time }}</span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="pagination">
            {% if page > 1 %}
            <a class="page-btn" href="{{ url_for('view_logs', page=page-1, risk=risk_filter) }}">
                ‚Üê Previous
            </a>
            {% endif %}

            <span class="page-btn active">Page {{ page }} of {{ total_pages }}</span>

            {% if page < total_pages %}
            <a class="page-btn" href="{{ url_for('view_logs', page=page+1, risk=risk_filter) }}">
                Next ‚Üí
            </a>
            {% endif %}
        </div>

        {% else %}
        <div class="empty-logs">
            <h3>üì≠ No Detection Records Found</h3>
            <p>The system has not recorded any animal detections yet.</p>
            <p>Detection logs will appear here when animals are detected.</p>
        </div>
        {% endif %}

        <footer>
            <p>Detection System v2.1 | Logs updated in real-time | 
                <span class="timestamp">Last refresh: {{ logs[-1].time if logs else 'No data' }}</span>
            </p>
        </footer>
    </div>

    <script>
        // Add interactivity to filter buttons
        document.querySelectorAll('.filter-btn').forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all buttons
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                // Add active class to clicked button
                this.classList.add('active');
                
                // Here you would typically filter the logs based on the selected filter
                console.log('Filter clicked:', this.textContent);
            });
        });

        // Add row click functionality
        document.querySelectorAll('tbody tr').forEach(row => {
            row.addEventListener('click', function() {
                this.style.backgroundColor = 'rgba(30, 136, 229, 0.15)';
                
                // Here you could implement a detail view for the log entry
                const animal = this.cells[0].textContent.trim();
                console.log('Log entry clicked:', animal);
            });
        });

        // Auto-refresh simulation
        setInterval(() => {
            const lastUpdate = document.querySelector('.timestamp');
            if (lastUpdate) {
                const now = new Date();
                const timeString = now.toLocaleTimeString();
                lastUpdate.textContent = timeString;
            }
        }, 60000); // Update every minute
    </script>
</body>
</html>